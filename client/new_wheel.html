<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>微信抽奖转盘</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .wheel-gradient {
                background: radial-gradient(circle, #ffecd2 0%, #fcb69f 100%);
            }
            .prize-shadow {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B6B',
                        secondary: '#4ECDC4',
                        accent: '#FFD166',
                        dark: '#292F36',
                        light: '#F7FFF7'
                    },
                    fontFamily: {
                        sans: ['PingFang SC', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                },
            }
        }
    </script>
</head>
<body class="bg-gradient-to-b from-blue-50 to-purple-50 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- 顶部标题 -->
        <div class="text-center mb-6">
            <h1 class="text-[clamp(1.8rem,5vw,2.5rem)] font-bold text-dark mb-2">幸运抽奖转盘</h1>
            <p class="text-gray-600">试试你的运气，赢取丰厚奖品！</p>
        </div>
        
        <!-- 抽奖区域 -->
        <div class="relative max-w-md mx-auto">
            <!-- 转盘 -->
            <div class="relative aspect-square">
                <!-- 指针 -->
                <div class="absolute -top-5 left-1/2 transform -translate-x-1/2 z-10">
                    <div class="w-8 h-16 bg-primary rounded-b-full flex justify-center">
                        <div class="w-2 h-6 bg-yellow-300 rounded-full mt-3"></div>
                    </div>
                </div>
                
                <!-- 转盘容器 -->
                <div id="wheel-container" class="w-full h-full">
                    <div id="wheel" class="w-full h-full rounded-full wheel-gradient border-8 border-primary shadow-xl transition-transform duration-3000 ease-out transform-origin-center">
                        <!-- 奖品区域将通过JavaScript生成 -->
                    </div>
                </div>
                
                <!-- 抽奖按钮 -->
                <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10">
                    <button id="spin-btn" class="w-24 h-24 rounded-full bg-primary text-white font-bold text-lg shadow-lg flex items-center justify-center border-4 border-white transition-all hover:bg-red-600 active:scale-95">
                        开始抽奖
                    </button>
                </div>
            </div>
            
            <!-- 剩余次数 -->
            <div class="mt-6 text-center">
                <p id="remaining-spins" class="text-lg text-dark font-semibold">剩余抽奖次数: <span class="text-primary">3</span></p>
            </div>
        </div>
        
        <!-- 奖品说明 -->
        <div class="max-w-md mx-auto mt-8 bg-white rounded-xl shadow-md p-5">
            <h2 class="text-xl font-bold text-dark mb-3 flex items-center">
                <i class="fa fa-gift text-accent mr-2"></i>奖品说明
            </h2>
            <div class="space-y-2" id="prize-list">
                <!-- 奖品列表将通过JavaScript生成 -->
            </div>
        </div>
        
        <!-- 抽奖结果弹窗 -->
        <div id="result-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 transform transition-all">
                <div class="text-center">
                    <h3 class="text-2xl font-bold text-primary mb-2">抽奖结果</h3>
                    <div id="modal-icon" class="text-6xl my-4"></div>
                    <p id="modal-message" class="text-xl mb-6"></p>
                    <button id="modal-close" class="bg-primary text-white font-bold py-2 px-8 rounded-full transition hover:bg-red-600">
                        确定
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 在DOM加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 奖品配置
            const prizes = [
                { name: '一等奖', icon: 'fa-trophy', color: '#FFD700', weight: 5 },
                { name: '二等奖', icon: 'fa-gift', color: '#C0C0C0', weight: 10 },
                { name: '三等奖', icon: 'fa-star', color: '#CD7F32', weight: 20 },
                { name: '谢谢参与', icon: 'fa-smile-o', color: '#CCCCCC', weight: 65 }
            ];
            
            // 变量初始化
            let remainingSpins = 3;
            let isSpinning = false;
            let prizeItems = [];
            let prizeHistory = [];
            
            // DOM元素
            const wheel = document.getElementById('wheel');
            const spinBtn = document.getElementById('spin-btn');
            const remainingSpinsEl = document.getElementById('remaining-spins').querySelector('span');
            const resultModal = document.getElementById('result-modal');
            const modalIcon = document.getElementById('modal-icon');
            const modalMessage = document.getElementById('modal-message');
            const modalClose = document.getElementById('modal-close');
            const prizeList = document.getElementById('prize-list');
            
            // 创建奖品扇区
            function initWheel() {
                // 清空转盘
                wheel.innerHTML = '';
                prizeItems = [];
                
                // 计算每个奖品的角度
                const angle = 360 / prizes.length;
                
                // 创建奖品扇区
                for (let i = 0; i < prizes.length; i++) {
                    const prize = prizes[i];
                    const prizeEl = document.createElement('div');
                    
                    // 设置样式和内容
                    prizeEl.className = 'absolute w-full h-full flex items-center justify-center overflow-hidden prize-shadow';
                    prizeEl.style.transform = `rotate(${i * angle}deg)`;
                    prizeEl.setAttribute('data-prize-index', i);
                    
                    // 创建扇区内的内容
                    const prizeContent = document.createElement('div');
                    prizeContent.className = 'absolute w-full h-1/2 flex flex-col items-center justify-center transform origin-bottom';
                    prizeContent.style.transform = `rotate(${angle / 2}deg)`;
                    prizeContent.style.backgroundColor = prize.color;
                    
                    // 添加图标和文字
                    prizeContent.innerHTML = `
                        <i class="fa ${prize.icon} text-white text-2xl mb-2"></i>
                        <div class="text-white font-bold text-center px-2">${prize.name}</div>
                    `;
                    
                    prizeEl.appendChild(prizeContent);
                    wheel.appendChild(prizeEl);
                    prizeItems.push(prizeEl);
                }
                
                // 创建奖品说明列表
                createPrizeList();
            }
            
            // 创建奖品说明列表
            function createPrizeList() {
                prizeList.innerHTML = '';
                
                prizes.forEach(prize => {
                    const prizeItem = document.createElement('div');
                    prizeItem.className = 'flex items-center p-2 border-b border-gray-100';
                    
                    const percentage = Math.round((prize.weight / getTotalWeight()) * 100);
                    
                    prizeItem.innerHTML = `
                        <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3" style="background-color: ${prize.color}">
                            <i class="fa ${prize.icon} text-white"></i>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium">${prize.name}</div>
                            <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                <div class="h-2 rounded-full" style="background-color: ${prize.color}; width: ${percentage}%"></div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-500">${percentage}%</div>
                    `;
                    
                    prizeList.appendChild(prizeItem);
                });
            }
            
            // 计算总权重
            function getTotalWeight() {
                return prizes.reduce((total, prize) => total + prize.weight, 0);
            }
            
            // 根据权重选择奖品
            function selectPrize() {
                const totalWeight = getTotalWeight();
                let random = Math.random() * totalWeight;
                
                for (let i = 0; i < prizes.length; i++) {
                    random -= prizes[i].weight;
                    if (random <= 0) {
                        return i;
                    }
                }
                
                return prizes.length - 1; // 默认返回最后一个
            }
            
            // 旋转转盘
            function spinWheel() {
                if (isSpinning || remainingSpins <= 0) return;
                
                isSpinning = true;
                spinBtn.disabled = true;
                spinBtn.textContent = '抽奖中...';
                
                // 选择中奖奖品
                const selectedIndex = selectPrize();
                prizeHistory.push(selectedIndex);
                
                // 减少抽奖次数
                remainingSpins--;
                remainingSpinsEl.textContent = remainingSpins;
                
                // 计算旋转角度（5-8圈随机）
                const spins = 5 + Math.floor(Math.random() * 4);
                const targetAngle = 360 - (selectedIndex * (360 / prizes.length) + (360 / prizes.length) / 2);
                const totalAngle = spins * 360 + targetAngle;
                
                // 应用旋转
                wheel.style.transform = `rotate(${totalAngle}deg)`;
                
                // 显示结果
                setTimeout(() => {
                    showResult(selectedIndex);
                    isSpinning = false;
                    spinBtn.disabled = remainingSpins <= 0;
                    spinBtn.textContent = remainingSpins > 0 ? '开始抽奖' : '次数用完';
                }, 3000);
            }
            
            // 显示抽奖结果
            function showResult(prizeIndex) {
                const prize = prizes[prizeIndex];
                
                // 设置弹窗内容
                modalIcon.className = `fa ${prize.icon} text-6xl my-4`;
                modalIcon.style.color = prize.color;
                
                if (prize.name === '谢谢参与') {
                    modalMessage.textContent = '很遗憾，' + prize.name + '！';
                } else {
                    modalMessage.textContent = '恭喜您获得：' + prize.name + '！';
                }
                
                // 显示弹窗
                resultModal.classList.remove('hidden');
                
                // 防止页面滚动
                document.body.style.overflow = 'hidden';
            }
            
            // 关闭结果弹窗
            function closeResultModal() {
                resultModal.classList.add('hidden');
                document.body.style.overflow = '';
            }
            
            // 绑定事件
            spinBtn.addEventListener('click', spinWheel);
            modalClose.addEventListener('click', closeResultModal);
            
            // 点击弹窗外部关闭
            resultModal.addEventListener('click', function(e) {
                if (e.target === resultModal) {
                    closeResultModal();
                }
            });
            
            // 初始化转盘
            initWheel();
            
            // 检查是否在微信环境中
            function isWechat() {
                const ua = navigator.userAgent.toLowerCase();
                return ua.indexOf('micromessenger') !== -1;
            }
            
            // 微信环境下的特殊处理
            if (isWechat()) {
                console.log('在微信环境中运行');
                // 这里可以添加微信环境特有的功能
            }
        });
    </script>
</body>
</html>